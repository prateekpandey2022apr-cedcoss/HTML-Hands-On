<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="style.css"> -->

    <style>

        table, td{
            border: 1px solid #e3e3e3;
            border-collapse: collapse;            
            padding: 10px 20px;
        }

        form{
            margin: 20px auto;
        }

    </style>

</head>

    <form action="" onsubmit="process_form(event);" id="add_product_form">

        <table>
            <tr>
                <td><label for="company">Company</label></td>
                <td><input type="text" name="company" id="company"></td>
            </tr>
            <tr>
                <td><label for="model">Model</label></td>
                <td><input type="text" name="model" id="model"></td>
            </tr>
            <tr>
                <td><label for="memory">Memory</label></td>
                <td><input type="text" name="memory" id="memory"></td>
            </tr>
            <tr>
                <td><label for="price">Price</label></td>
                <td><input type="text" name="price" id="price"></td>
            </tr>

            <tr>
                <td></td>
                <td><input type="submit" name="submit" id="submit"></td>
            </tr>
        </table>
                
    </form>

    <ul id="errors">
        
    </ul>

    <hr>

    <table id="product_list">

    </table>

<body>

    <!-- <script src="main.js"></script> -->

    <script>

    let heading = ['Company', 'Model', 'Memory (GB)', 'Price (RS)'];

    let products = [
        ['Samsung', 'Galaxy', 64, 15000],
        ['Nokia', 'S730', 128, 22000],
        ['Xiaomi', 'Note', 32, 12000],
        ['Motorola', 'G10', 32, 15000],
        ['Apple', 'S12', 64, 25000],
    ];

    let sort_data_type, sort_order, idx_to_search;


    console.log(products);

    function process_form(event)
    {
        event.preventDefault();
        debugger;

        let form = document.getElementById("add_product_form");
        let ul = document.getElementById("errors");

        let product_info = [];

        let requried_fields = ['company', 'model', 'memory', 'price'];
        let message = ['alphabetic', 'alphanumeric', 'numeric', 'numeric'];
        let validators = [/^[a-z]+$/i, /\w+/i, /^\d+$/, /^\d+$/];
        let errors = [];
        let i = 0;

        for (const element of form.elements) 
        {
            console.log(element);
            if (element.type == "text")
            {
                if(!validators[i].test(element.value))
                {
                    errors.push([element.id, message[i]]);
                }            
                i++;
            }
        }

        if(errors.length)
        {
            let ul = document.getElementById("errors");
            ul.innerHTML = "";
            let li_arr = [];
            
            for (const error of errors) 
            {
                let li = document.createElement("li");
                li.appendChild(document.createTextNode(
                    error[0] + " must contain " + error[1] +
                    " characters"
                ));                         
                ul.appendChild(li);
            }

            return;
        }

        ul.innerHTML = "";
        
        for (const element of form.elements) 
        {
            console.log(element);

            if (element.type == "text")
            {
                product_info.push(element.value);
            }            
        }

        console.log(errors);
        console.log(product_info);

        form.reset();

        // add_row(product_info);
        add_row_at_index_2(product_info);
    }

    function add_row_at_index_2(product_info)
    {
        let tb = document.getElementById("product_list");
        let row = tb.insertRow(2);
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        let cell3 = row.insertCell(2);
        let cell4 = row.insertCell(3);

        cell1.innerHTML = product_info[0];
        cell2.innerHTML = product_info[1];
        cell3.innerHTML = product_info[2];
        cell4.innerHTML = product_info[3];
        
        return;
    }


    function clear_table()
    {
        let tb = document.getElementById("product_list");
        let tr_count = tb.childElementCount;

        for (let index = tr_count - 1; index > 0; index--) 
        {
            document.getElementById("product_list").deleteRow(index);   
        }
    }

    function sort_table(event)
    {
        event.preventDefault();

        // debugger;
        clear_table();

        let criteria = document.getElementById("criteria");
        sort_order = document.getElementById("sort_order").value;

        console.log(criteria.value, sort_order);

        idx_to_search = heading.indexOf(criteria.value);        
        sort_data_type = typeof products[0][idx_to_search];

        // create dupe products list
        let product_copy = JSON.parse(JSON.stringify(products));

        product_copy.sort(comparator);

        console.log(product_copy);

        populate_table(product_copy);

    }

    function populate_table(product_copy)
    {
        for (const row of product_copy) 
        {
            // console.log(row);
            add_row(row)
        }
    }


    function comparator(a, b)
    {
        if(sort_data_type == "string")
        {
            if(a[idx_to_search] < b[idx_to_search])  
            {
                return sort_order == "asc" ?-1: 1;
            }

            if(a[idx_to_search] > b[idx_to_search])
            {
                return sort_order == "asc" ?1 : -1;
            }

            return 0;
        }

        else
        {
            return sort_order == "asc" ? 
            a[idx_to_search] - b[idx_to_search] : 
            b[idx_to_search] - a[idx_to_search];                    
        }
    }

    function add_row(row) 
    {
        var tb = document.getElementById("product_list");
        var tr = document.createElement("tr");
        
        var td_node_arr = []

        for (const item of row) 
        {                
            // console.log(item);                   
            let td = document.createElement("td")                                                
            td.appendChild(document.createTextNode(item));
            td_node_arr.push(td);
        }            

        // console.log(td_node_arr);                     

        // console.log(td_node_arr);

        tr.appendChild(td_node_arr[0]);
        tr.appendChild(td_node_arr[1]);
        tr.appendChild(td_node_arr[2]);
        tr.appendChild(td_node_arr[3]);

        tb.appendChild(tr);

        // form.reset();        
    }

    function print_header() 
    {
        add_row(heading);
    }

    function page_load()
    {
        console.log("Page Loaded");        
        print_header();
        populate_table(products)
    }

    window.onload = page_load;

    </script>
    
</body>
</html>